// stdafx.h : include file for standard system include files,
// or project specific include files that are used frequently,
// but are changed infrequently

#pragma once

#ifndef STRICT
#define STRICT
#endif

#include "targetver.h"

#define _ATL_APARTMENT_THREADED
#define _ATL_NO_AUTOMATIC_NAMESPACE

#define _ATL_CSTRING_EXPLICIT_CONSTRUCTORS	// some CString constructors will be explicit

#include "resource.h"
#include <atlbase.h>
#include <atlstr.h>
#include <atlcom.h>
#include <atlctl.h>
#include <atlcoll.h>
#include <atlfile.h>
#include <activdbg.h>

using namespace ATL;

#include "Misc.h"
using namespace Misc;

#include "libbhohelper.h"
using namespace LIB_BhoHelper;

// Temporary solution: Script wrapping because of the bug with
// GetScriptDispatch() in jscript9. See CMagpieActiveScript::RunModule.
extern LPCOLESTR gJscript9ModuleWrapperIntro;
extern LPCOLESTR gJscript9ModuleWrapperExtro;

#ifdef _DEBUG
// enable script debugger
#define SCRIPTDEBUG_
#endif

// some shortcut macros for error checking

#ifdef _DEBUG
//#define _DEBUG_BREAK
#endif

#ifdef _DEBUG_BREAK
#define ASSERT_ ATLASSERT
#else
#define ASSERT_
#endif

#define IF_FAILED_RET(_hr) \
  do \
  { \
    HRESULT _hr__ = _hr; \
    ASSERT_(SUCCEEDED(_hr__)); \
    if (FAILED(_hr__)) \
    { \
      ATLTRACE(_T("ASSERTION FAILED: 0x%08x in "), _hr__); \
      ATLTRACE(__FILE__); \
      ATLTRACE(_T(" line %i\n"), __LINE__); \
      return _hr__; \
    } \
  } while(0);

#define IF_FAILED_RET2(_hr, _ret) \
  do \
  { \
    HRESULT _hr__ = _hr; \
    ASSERT_(SUCCEEDED(_hr__)); \
    if (FAILED(_hr__)) \
    { \
      ATLTRACE(_T("ASSERTION FAILED: 0x%08x in "), _hr__); \
      ATLTRACE(__FILE__); \
      ATLTRACE(_T(" line %i\n"), __LINE__); \
      return _ret; \
    } \
  } while(0);

#define ENSURE_RETVAL(_val) \
  if (!_val) return E_POINTER;
